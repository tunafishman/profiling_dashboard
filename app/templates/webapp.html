<!DOCTYPE html>
<html>
<head>
    <title>Multipurpose Dashboard</title>
    <link rel="stylesheet" type="text/css" href="static/css/dashboard.css" />
    <link rel="stylesheet" type="text/css" href="static/libs/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="static/libs/nvd3/css/nv.d3.css" />
    <script src="static/libs/d3/js/d3.min.js" charset="utf-8"></script>
    <script src="static/libs/nvd3/js/nvd3.js"></script>
    <script type="text/javascript" src="static/libs/jQuery/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="static/libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="static/js/comparables.js"></script>
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.1/css/select2.min.css" rel="stylesheet" />
    <script src="static/libs/select2/select2.min.js"></script>
</head>
<body class="application">

  <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="./">TwinPrime Profiling Dashboard</a>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div id="controls" style="width:100%; overflow:auto">
      <div id="internalNav" style="width:10%; float:left">
        <select id="cid" style="width:100%">
        <!--{% for item in customers %}
        <option value={{ item.cid }}>{{ item.name }}</option>
        {% endfor %}-->
        </select>
        <div style="width:100%; text-align:center"> ------------- </div>
        <ul id="pages">
          <li id="dashboard"><a href='javascript:void(0);'>Dashboard</a></li>
          <li id="lifecycles">Lifecycles</li>
          <li id="profiling"><a href='javascript:void(0);'>Profiling</a></li>
        </ul>
      </div>
      <div id="segControls" style="width:88%; float:right">
      </div>
      <div style="text-align:center">
        <input id="fetch" type="button" value="Run" />
      </div>
    </div>
    
    {% block module %}{% endblock %}
  <script>
    window.base_api = "{{ api_url }}";
    $( window ).load( function () {

      //set up the cid selector
      customers = {{ customers|tojson }}.map( function(item) {return {id: item.cid, text: item.name} } )

      customers.unshift("") //select2 works with a placeholder only with explicit blank option at the top
      $( "#cid" ).select2({
          placeholder: "Select a customer",
          data: customers
      })

                

      $( "#cid" ).on("select2:select", function(yo) { 
          console.log('select', yo), 
          selectedCid = yo.params.data.id //? yo.params.data.id : $("#cid").val() //ugh. Handle initial set in an ugly way :(
          window.s = segControls( "#segControls", yo.params.data.id) 
          makeGraphs(s);
          
      })

      $( "#fetch" ).on("click", function() {
          makeGraphs(s);
      });
      
      $( '#dashboard a' ).on('click', function() {
          window.location.href = "./"
      })

      $( '#dashboard a' ).on('click', function() {
          controls = typeof s != 'undefined' ? s.read() : '';
          args = controls ? '?' + $.param(controls) : '';
          link_url = "./" + args 
          window.location.href = link_url;
      })
      $( '#profiling a' ).on('click', function() {
          controls = typeof s != 'undefined' ? s.read() : '';
          args = controls ? '?' + $.param(controls) : '';
          link_url = "./profiling" + args 
          window.location.href = link_url;
      })

      //handle url params if they exist 
      {% if page_state.cid %}
      $( "#cid" ).val("{{ page_state.cid }}").change()
      selected = "{{ page_state.selector }}" != "False" ? "{{ page_state.selector }}" : false;
      breakout = "{{ page_state.breakout }}" != "False" ? "{{ page_state.breakout }}" : false;
      window.s = segControls ( "#segControls", "{{page_state.cid}}") 
      s.set(selected, breakout, function() { makeGraphs(s); })

      {% endif %}

    });
  </script>

</body>
</html>
